<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Admin ‚Äì Qu·∫£n l√Ω s·∫£n ph·∫©m</title>

    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f7dce2;
        padding: 40px;
      }

      .box {
        max-width: 420px;
        margin: auto;
        background: #fff;
        padding: 24px;
        border-radius: 12px;
        margin-bottom: 20px;
      }

      h2 {
        text-align: center;
      }

      input,
      button {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
      }

      button {
        background: #e56b8f;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 6px;
      }

      .hidden {
        display: none;
      }
    </style>
  </head>

  <body>
    <!-- LOGIN -->
    <div class="box" id="loginBox">
      <h2>üîê Admin Login</h2>
      <input id="email" placeholder="Email" />
      <input id="password" type="password" placeholder="Password" />
      <button onclick="login()">ƒêƒÉng nh·∫≠p</button>
    </div>

    <!-- ADMIN FORM -->
    <div class="box hidden" id="adminBox">
      <h2>üì¶ Nh·∫≠p s·∫£n ph·∫©m</h2>

      <input id="code" placeholder="M√£ s·∫£n ph·∫©m (AD81)" />
      <input id="name" placeholder="T√™n s·∫£n ph·∫©m" />
      <input id="brand" placeholder="Brand (kh√¥ng b·∫Øt bu·ªôc)" />
      <input id="size" placeholder="Size" />
      <input id="price" type="number" placeholder="Gi√° thu√™" />
      <input id="deposit" type="number" placeholder="Ti·ªÅn c·ªçc" />
      <input id="image" placeholder="Link ·∫£nh" />

      <button onclick="addProduct()">L∆∞u s·∫£n ph·∫©m</button>
      <button onclick="logout()">ƒêƒÉng xu·∫•t</button>
    </div>

    <!-- FIREBASE -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import {
        getFirestore,
        doc,
        setDoc,
      } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDEhLtpnDKTMTBq2wlMiox56cXmOLdi7Lg",
        authDomain: "anhduc-a60b2.firebaseapp.com",
        projectId: "anhduc-a60b2",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);

      const loginBox = document.getElementById("loginBox");
      const adminBox = document.getElementById("adminBox");

      // LOGIN
      window.login = async function () {
        const emailInput = document.getElementById("email").value;
        const passwordInput = document.getElementById("password").value;

        try {
          await signInWithEmailAndPassword(auth, emailInput, passwordInput);
        } catch (err) {
          alert("‚ùå ƒêƒÉng nh·∫≠p th·∫•t b·∫°i: " + err.message);
        }
      };

      // LOGOUT
      window.logout = async function () {
        await signOut(auth);
      };

      // CHECK LOGIN
      onAuthStateChanged(auth, (user) => {
        if (user) {
          loginBox.classList.add("hidden");
          adminBox.classList.remove("hidden");
        } else {
          loginBox.classList.remove("hidden");
          adminBox.classList.add("hidden");
        }
      });

      // ADD PRODUCT
      window.addProduct = async function () {
        let code = document.getElementById("code").value.trim().toUpperCase();
        if (!code.startsWith("AD")) code = "AD" + code;

        const brand = document.getElementById("brand").value.trim();

        const data = {
          name: document.getElementById("name").value,
          size: document.getElementById("size").value,
          price: Number(document.getElementById("price").value),
          deposit: Number(document.getElementById("deposit").value),
          image: document.getElementById("image").value,
          ...(brand && { brand }),
        };

        await setDoc(doc(db, "products", code), data);
        alert("‚úÖ ƒê√£ l∆∞u " + code);
      };
    </script>
  </body>
</html>
